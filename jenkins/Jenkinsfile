pipeline {
    agent none
    stages {
        stage('Build') {
            agent {
                docker {
                    image 'python:2-alpine'
                }
            }
            steps {
                sh 'python -m py_compile sources/add2vals.py sources/calc.py'
            }
        }
        stage('Test') {
          
            agent {
                docker {
                    image 'pytest/cyy:v1'
                }
            }
            steps {
                sh 'pytest sources/test_allure.py --alluredir ./allure-results/'
            }
        }

   }
    post{
         always{
             agent{
                  docker {
                   image 'openjdk:8-jre'
                  }
            }
             script {
                 allure([
                        includeProperties: false,
                        jdk: '',
                        properties: [],
                        reportBuildPolicy: 'ALWAYS',
                        results: [[path: 'allure-results']]
                      ])
                   }
          
        }
    }
}